{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="max-w-lg mx-auto">
    <h1>Search Characters or Episodes</h1>
    <input type="text" id="search-input" placeholder="Search..." value="{{ query }}">
    <div id="results">
        {% if results %}
        <ul>
            {% for result in results %}
            <li><a href="{{ result.url }}"><strong>{{ result.name }}</strong></a></li>
            {% endfor %}
        </ul>
        {% elif query %}
        <p>No results found.</p>
        {% endif %}
    </div>

    <script>
        $(document).ready(function () {
            let debounceTimer;
            $('#search-input').on('input', function () {
                clearTimeout(debounceTimer);
                var query = $(this).val();
                debounceTimer = setTimeout(function () {
                    $.ajax({
                        url: "{% url 'search' %}",
                        data: {
                            'q': query
                        },
                        dataType: 'json',
                        success: function (data) {
                            var resultsDiv = $('#results');
                            resultsDiv.empty();
                            if (data.results.length > 0) {
                                var ul = $('<ul></ul>');
                                data.results.forEach(function (item) {
                                    var li = $('<li></li>');
                                    var a = $('<a></a>').attr('href', item.url).html('<strong>' + item.name + '</strong>');
                                    li.append(a);
                                    ul.append(li);
                                });
                                resultsDiv.append(ul);
                            } else if (query) {
                                resultsDiv.append('<p>No results found.</p>');
                            }
                        }
                    });
                }, 300); // Adjust the debounce delay as needed
            });
        });
    </script>
</div>
{% endblock %}