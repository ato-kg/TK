{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="bg-blue-50 text-gray-800 min-h-screen flex flex-col items-center">

    <!-- Header -->
    <header class="bg-yellow-300 shadow-md w-full">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <a href="/" class="flex items-center space-x-2">
                <img src="{% static 'images/default.png' %}" alt="Logo" class="w-12 h-12 rounded-full">
                <span class="text-xl font-bold text-gray-900">SpongeBob Fandom</span>
            </a>
            <nav class="space-x-6">
                <a href="/characters" class="hover:text-blue-600">Characters</a>
                <a href="/episodes" class="hover:text-blue-600">Episodes</a>
            </nav>
        </div>
    </header>

    <!-- Search Section -->
    <main class="flex-grow flex flex-col justify-center items-center">
        <h1 class="text-4xl font-extrabold text-gray-900 text-center mb-6">
            Dive into the SpongeBob Universe!
        </h1>

        <div class="max-w-xl w-full">
            <div class="relative">
                <input type="text" id="search-input" placeholder="Search for characters, episodes..."
                    class="w-full py-3 px-5 rounded-full border border-gray-300 shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-300">
            </div>
            <div id="results" class="mt-4">

            </div>
        </div>
    </main>
</div>

<!-- AJAX Search Script -->
<script>
    $(document).ready(function () {
        let debounceTimer;
        $('#search-input').on('input', function () {
            clearTimeout(debounceTimer);
            var query = $(this).val();
            debounceTimer = setTimeout(function () {
                $.ajax({
                    url: "{% url 'search' %}",
                    data: { 'q': query },
                    dataType: 'json',
                    success: function (data) {
                        var resultsDiv = $('#results');
                        resultsDiv.empty();
                        if (data.results.length > 0) {
                            var ul = $('<ul class="bg-white rounded-md shadow-md divide-y divide-gray-200"></ul>');
                            data.results.forEach(function (item) {
                                var li = $('<li class="p-3 hover:bg-yellow-100"></li>');
                                var a = $('<a></a>')
                                    .attr('href', item.url)
                                    .addClass('text-blue-600 font-semibold')
                                    .text(item.name);
                                var p = $('<p></p>')
                                    .addClass('text-gray-600')
                                    .text(item.type);
                                li.append(a);
                                li.append(p);
                                ul.append(li);
                            });
                            resultsDiv.append(ul);
                            if (data.more_results) {
                                var seeMoreLink = $('<a></a>')
                                    .attr('href', '#')
                                    .addClass('text-blue-600 font-semibold mt-4 block text-center')
                                    .text('See more results');
                                resultsDiv.append(seeMoreLink);
                            }
                        } else if (query) {
                            resultsDiv.append('<p class="text-gray-600 mt-2">No results found.</p>');
                        }
                    }
                });
            }, 300); // Debounce delay
        });
    });
</script>
{% endblock %}